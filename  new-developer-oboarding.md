# üöÄ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
## –ö–∞–∫ –º—ã —Ä–µ–∞–ª—å–Ω–æ –ø–∏—à–µ–º –∫–æ–¥ - Deep Dive –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

---

## üéØ –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤, –∞ **–ø–æ–ª–Ω–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ** –≤ —Ç–æ, –∫–∞–∫ –º—ã —Ä–µ–∞–ª—å–Ω–æ —Å—Ç—Ä–æ–∏–º —Å–∏—Å—Ç–µ–º—ã. –ö–∞–∂–¥—ã–π –ø—Ä–∏–º–µ—Ä –≤–∑—è—Ç –∏–∑ –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–¥–∞, –∫–∞–∂–¥—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –æ–±—ä—è—Å–Ω–µ–Ω —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

**–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤—ã –±—É–¥–µ—Ç–µ:**
- –ü–æ–Ω–∏–º–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–æ–π –Ω–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ó–Ω–∞—Ç—å, –≥–¥–µ –∏ –∫–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ü–∏—Å–∞—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π seamless –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É
- –ü–æ–Ω–∏–º–∞—Ç—å WHY –º—ã –¥–µ–ª–∞–µ–º –∏–º–µ–Ω–Ω–æ —Ç–∞–∫

---

## üèóÔ∏è –†–µ–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤

### –ê–Ω–∞—Ç–æ–º–∏—è –ø—Ä–æ–µ–∫—Ç–∞ AI-Mentor

–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º **—Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É** –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

```
ai-mentor-system/
‚îú‚îÄ‚îÄ infrastructure/                 # –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ pg/pg.py                   # PostgreSQL —Å —Ç—Ä–µ–π—Å–∏–Ω–≥–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ redis_client/              # Redis —Å connection pooling
‚îÇ   ‚îú‚îÄ‚îÄ telemetry/                 # OpenTelemetry stack
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telemetry.py          # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.py             # Structured logging
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ alertmanager.py       # Telegram –∞–ª–µ—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ weedfs/weedfs.py          # Distributed file storage
‚îÇ   ‚îî‚îÄ‚îÄ docker/                    # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îú‚îÄ‚îÄ internal/                      # –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ interface/                 # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã - —Å–µ—Ä–¥—Ü–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ general.py            # –ë–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (DB, Logger, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/chat.py          # –ß–∞—Ç —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ edu/student.py        # –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client/llm.py         # LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ model/                     # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ account/account.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/chat.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ edu/student.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sql_model.py          # DDL –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îú‚îÄ‚îÄ repo/                      # Data Access Layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ account/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ query.py          # SQL –∑–∞–ø—Ä–æ—Å—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repo.py           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Repository
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ edu/
‚îÇ   ‚îú‚îÄ‚îÄ service/                   # Business Logic Layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service.py        # Orchestration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompt.py         # LLM –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ topic_formatter.py # Data formatting
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ edu/
‚îÇ   ‚îú‚îÄ‚îÄ controller/               # Presentation Layer
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ handler/          # HTTP handlers
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ middleware/       # HTTP middleware
‚îÇ   ‚îú‚îÄ‚îÄ config/config.py          # Environment configuration
‚îÇ   ‚îî‚îÄ‚îÄ common/                   # Shared utilities
‚îú‚îÄ‚îÄ pkg/                          # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ client/external/openai/   # External API clients
‚îú‚îÄ‚îÄ docker-compose/               # Orchestration
‚îÇ   ‚îú‚îÄ‚îÄ app.yaml                  # Application services
‚îÇ   ‚îú‚îÄ‚îÄ db.yaml                   # Database services
‚îÇ   ‚îî‚îÄ‚îÄ monitoring.yaml           # Observability stack
‚îú‚îÄ‚îÄ env/                          # Environment configs
‚îú‚îÄ‚îÄ monitoring/                   # Monitoring configurations
‚îî‚îÄ‚îÄ main.py                       # Application bootstrap
```

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?

**1. –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- `infrastructure/` - –í–°–ï —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞
- `internal/` - –¢–û–õ–¨–ö–û –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `pkg/` - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**2. Dependency Rule:**
- `internal/` –ù–ï –ó–ù–ê–ï–¢ –ø—Ä–æ `infrastructure/`
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üß± –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã - –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –†–ï–ê–õ–¨–ù–û

### Layer 1: Interface Layer - –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–≠—Ç–æ **—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Å–ª–æ–π** - –≤—Å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å:

```python
# internal/interface/general.py - –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
class ITelemetry(Protocol):
    @abstractmethod
    def tracer(self) -> Tracer: pass
    
    @abstractmethod
    def meter(self) -> Meter: pass
    
    @abstractmethod
    def logger(self) -> IOtelLogger: pass

class IDB(Protocol):
    @abstractmethod
    async def insert(self, query: str, query_params: dict) -> int: pass
    
    @abstractmethod
    async def select(self, query: str, query_params: dict) -> Sequence[Any]: pass
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?**
- –õ—é–±–æ–π —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±–æ–π –ë–î
- –ú–æ–∂–µ–º –ª–µ–≥–∫–æ –º–æ–∫–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –ß–µ—Ç–∫–æ –≤–∏–¥–Ω—ã –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### Layer 2: Model Layer - –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

```python
# internal/model/edu/student.py
@dataclass
class Student:
    id: int
    account_id: int
    
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—É—á–µ–Ω–∏—è
    current_expert: str = None
    current_topic: dict[int, str] = None
    current_block: dict[int, str] = None
    
    # –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞
    programming_experience: str = None
    learning_goals: str = None
    
    # –ü—Ä–æ–≥—Ä–µ—Å—Å
    approved_topics: dict[int, str] = field(default_factory=dict)
    assessment_score: int = None
    
    @classmethod
    def serialize(cls, rows) -> list['Student']:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ë–î"""
        return [
            cls(
                id=row.id,
                account_id=row.account_id,
                current_expert=row.current_expert,
                # ... –≤—Å–µ –ø–æ–ª—è
            )
            for row in rows
        ]
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- `@dataclass` –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤
- `serialize()` - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑ –ë–î
- Type hints –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
- `field(default_factory=dict)` –¥–ª—è –º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö defaults

### Layer 3: Repository Layer - –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

```python
# internal/repo/edu/student/repo.py
class StudentRepo(interface.IStudentRepo):
    def __init__(self, tel: interface.ITelemetry, db: interface.IDB):
        self.db = db
        self.tracer = tel.tracer()

    async def get_by_id(self, student_id: int) -> list[model.Student]:
        with self.tracer.start_as_current_span(
                "StudentRepo.get_by_id",
                kind=SpanKind.INTERNAL,
                attributes={"student_id": student_id}
        ) as span:
            try:
                args = {'student_id': student_id}
                rows = await self.db.select(get_student_by_id, args)
                result = model.Student.serialize(rows) if rows else []
                
                span.set_status(StatusCode.OK)
                return result
            except Exception as err:
                span.record_exception(err)
                span.set_status(StatusCode.ERROR, str(err))
                raise err
```

**–ü–∞—Ç—Ç–µ—Ä–Ω –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ Repository:**
1. **–¢—Ä–µ–π—Å–∏–Ω–≥ span** —Å attributes
2. **Try-catch** —Å proper error handling  
3. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection)
4. **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ model.serialize()
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ span

### Layer 4: Service Layer - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

```python
# internal/service/chat/service.py
class ChatService(interface.IChatService):
    def __init__(
        self,
        tel: interface.ITelemetry,
        llm_client: interface.ILLMClient,
        prompt_generator: interface.IPromptGenerator,
        student_repo: interface.IStudentRepo,
        chat_repo: interface.IChatRepo,
    ):
        # Dependency Injection –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        self.tracer = tel.tracer()
        self.logger = tel.logger()
        self.llm_client = llm_client
        # ...

    async def send_message_to_expert(self, student_id: int, text: str) -> tuple[str, list[common.Command]]:
        with self.tracer.start_as_current_span(
                "ChatService.send_message",
                kind=SpanKind.INTERNAL,
                attributes={"student_id": student_id}
        ) as span:
            try:
                # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞
                student = (await self.student_repo.get_by_id(student_id))[0]
                
                # 2. –†–∞–±–æ—Ç–∞–µ–º —Å —á–∞—Ç–æ–º
                chat = await self._get_or_create_chat(student_id)
                await self.chat_repo.create_message(chat.id, Roles.user, text)
                
                # 3. –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ —ç–∫—Å–ø–µ—Ä—Ç–∞
                system_prompt = await self._get_prompt_for_expert(student.current_expert, student_id)
                
                # 4. –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
                chat_history = await self.chat_repo.get_messages(chat.id)
                
                # 5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM
                llm_response = await self.llm_client.generate(
                    history=chat_history,
                    system_prompt=system_prompt,
                    temperature=0.3
                )
                
                # 6. –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
                response_data = await self._parse_llm_response(llm_response)
                commands = [Command(**cmd) for cmd in response_data.get("metadata", {}).get("commands", [])]
                
                # 7. –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–∫—Å–ø–µ—Ä—Ç–∞
                await self._execute_commands_for_expert(student.current_expert, student_id, commands)
                
                span.set_status(StatusCode.OK)
                return response_data["user_message"], commands
                
            except Exception as err:
                span.record_exception(err)
                span.set_status(StatusCode.ERROR, str(err))
                raise err
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ö–ê–ñ–î–û–ì–û —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞:**
1. **Span —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** –¥–ª—è distributed tracing
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
3. **Orchestration** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
4. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** - —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
5. **Error handling** —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### Layer 5: Controller Layer - HTTP API

```python
# internal/controller/http/handler/chat/handler.py
class ChatController(interface.IChatController):
    def __init__(self, tel: interface.ITelemetry, chat_service: interface.IChatService):
        self.tracer = tel.tracer()
        self.logger = tel.logger()
        self.chat_service = chat_service

    async def send_message_to_expert(self, body: SendMessageToExpert):
        with self.tracer.start_as_current_span(
                "ChatController.send_message_to_expert",
                kind=SpanKind.INTERNAL,
                attributes={
                    "student_id": body.student_id,
                    "text": body.text
                }
        ) as span:
            try:
                user_message, commands = await self.chat_service.send_message_to_expert(
                    body.student_id,
                    body.text
                )

                response = SendMessageToExpertResponse(
                    user_message=user_message,
                    commands=commands
                )

                span.set_status(StatusCode.OK)
                return JSONResponse(
                    status_code=status.HTTP_200_OK,
                    content=response.to_dict(),
                )
            except Exception as err:
                span.record_exception(err)
                span.set_status(StatusCode.ERROR, str(err))
                raise err
```

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¢–û–õ–¨–ö–û:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ Pydantic –º–æ–¥–µ–ª–∏
- –í—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP –æ—Ç–≤–µ—Ç
- –ù–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏!

---

## üîå Dependency Injection - –∫–∞–∫ –º—ã —Å–æ–±–∏—Ä–∞–µ–º —Å–∏—Å—Ç–µ–º—É

### Bootstrap –≤ main.py

```python
# main.py - –°–±–æ—Ä–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
def main():
    # 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    cfg = Config()
    
    # 2. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
    alert_manager = AlertManager(cfg.alert_tg_bot_token, ...)
    tel = Telemetry(cfg.log_level, cfg.environment, ...)
    db = PG(tel, cfg.db_user, cfg.db_pass, ...)
    storage = Weed(cfg.weed_master_host, cfg.weed_master_port)
    llm_client = GPTClient(tel, cfg.openai_api_key)
    
    # 3. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (Data Access)
    account_repo = AccountRepo(tel, db)
    student_repo = StudentRepo(tel, db)
    chat_repo = ChatRepo(tel, db)
    topic_repo = TopicRepo(tel, db, storage)
    
    # 4. –°–µ—Ä–≤–∏—Å—ã (Business Logic)
    prompt_generator = PromptGenerator(tel, student_repo, topic_repo)
    chat_service = ChatService(tel, llm_client, prompt_generator, student_repo, topic_repo, chat_repo, account_repo)
    
    # 5. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (Presentation)
    chat_controller = ChatController(tel, chat_service)
    
    # 6. HTTP –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    http_app = NewHTTP(db, chat_controller, ...)
```

**–ü—Ä–∏–Ω—Ü–∏–ø –∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
- **–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö**: infrastructure ‚Üí repo ‚Üí service ‚Üí controller
- **–ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**: –∫–∞–∂–¥—ã–π —Å–ª–æ–π –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö
- **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Å–±–æ—Ä–∫–∏**: main.py –∑–Ω–∞–µ—Ç –æ–±–æ –≤—Å–µ–º

---

## üóÑÔ∏è –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö - —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### SQL –∫–∞–∫ –∫–æ–¥

```python
# internal/repo/edu/student/query.py
create_student = """
INSERT INTO students (
    account_id, 
    current_expert,
    created_at, 
    updated_at
)
VALUES (:account_id, 'registrator', NOW(), NOW())
RETURNING id;
"""

get_student_by_id = """
SELECT 
    id, account_id, current_expert, current_topic, current_block, current_chapter,
    programming_experience, education_background, learning_goals, career_goals, timeline,
    learning_style, lesson_duration, preferred_difficulty, recommended_topics, recommended_blocks,
    approved_topics, approved_blocks, approved_chapters, assessment_score, strong_areas, weak_areas,
    created_at, updated_at
FROM students
WHERE id = :student_id;
"""

update_student_background = """
UPDATE students
SET 
    programming_experience = COALESCE(:programming_experience, programming_experience),
    education_background = COALESCE(:education_background, education_background),
    -- –∏—Å–ø–æ–ª—å–∑—É–µ–º COALESCE –¥–ª—è optional updates
    updated_at = NOW()
WHERE id = :student_id;
"""
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã SQL:**
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection
- **COALESCE** –¥–ª—è optional updates
- **RETURNING** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ—Å–ª–µ INSERT
- **Explicit column lists** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º SELECT *

### JSONB –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä

```python
# –†–∞–±–æ—Ç–∞ —Å JSONB –ø–æ–ª—è–º–∏
add_topic_to_approved = """
UPDATE students
SET 
    approved_topics = COALESCE(approved_topics, '{}'::jsonb) || jsonb_build_object(:topic_id::text, :topic_name),
    updated_at = NOW()
WHERE id = :student_id;
"""

# –í Python –∫–æ–¥–µ
async def update_student_background(self, student_id: int, background: dict):
    args = {
        'student_id': student_id,
        'recommended_topics': json.dumps(background.get('recommended_topics')) if background.get('recommended_topics') else None,
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º dict –≤ JSON —Å—Ç—Ä–æ–∫—É –¥–ª—è PostgreSQL
    }
    await self.db.update(update_student_background, args)
```

### Database schema as code

```python
# internal/model/sql_model.py - –í–µ—Å—å DDL –≤ –∫–æ–¥–µ
create_queries = [
    """
    CREATE TABLE IF NOT EXISTS students (
        id SERIAL PRIMARY KEY,
        account_id INTEGER REFERENCES accounts(id) ON DELETE CASCADE,
        
        current_expert VARCHAR(50) DEFAULT 'registrator',
        current_topic JSONB DEFAULT '{}'::jsonb,
        current_block JSONB DEFAULT '{}'::jsonb,
        
        programming_experience TEXT,
        education_background TEXT,
        
        recommended_topics JSONB DEFAULT '{}'::jsonb,
        approved_topics JSONB DEFAULT '{}'::jsonb,
        
        assessment_score INTEGER CHECK (assessment_score >= 0 AND assessment_score <= 100),
        strong_areas JSONB DEFAULT '[]'::jsonb,
        
        created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
        updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
    """,
    # –ò–Ω–¥–µ–∫—Å—ã
    "CREATE INDEX IF NOT EXISTS idx_students_account_id ON students(account_id);",
]
```

---

## üé≠ Observability - –∫–∞–∫ –º—ã –≤–∏–¥–∏–º —Å–∏—Å—Ç–µ–º—É

### Structured Logging

```python
# infrastructure/telemetry/logger.py
class OtelLogger(interface.IOtelLogger):
    def log(self, level: str, message: str, fields: dict = None) -> None:
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
        file_info = self._get_caller_info(3)
        attributes = {common.FILE_KEY: file_info}

        # –î–æ–±–∞–≤–ª—è–µ–º extra –ø–æ–ª—è
        if fields:
            attributes.update(self._extract_extra_params(fields))

        # –ü–æ–ª—É—á–∞–µ–º trace context
        current_span = trace.get_current_span()
        if current_span and current_span.get_span_context().is_valid:
            span_context = current_span.get_span_context()
            trace_id = format(span_context.trace_id, '032x')
            span_id = format(span_context.span_id, '016x')
            
            attributes[common.TRACE_ID_KEY] = trace_id
            attributes[common.SPAN_ID_KEY] = span_id

            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ ERROR
            if level == "ERROR" and self.alert_manager:
                self.alert_manager.send_error_alert(trace_id, span_id)

        self.logger.log(log_level, f"{self.service_name} | {message}", extra=attributes)
```

**–ö–∞–∂–¥—ã–π –ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- Service name
- Trace ID –∏ Span ID
- –§–∞–π–ª –∏ —Å—Ç—Ä–æ–∫–∞ –æ—Ç–∫—É–¥–∞ –≤—ã–∑–≤–∞–Ω
- Structured fields
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### Distributed Tracing

```python
# –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤ span
async def get_by_id(self, student_id: int) -> list[model.Student]:
    with self.tracer.start_as_current_span(
            "StudentRepo.get_by_id",
            kind=SpanKind.INTERNAL,  # CLIENT –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤
            attributes={
                "student_id": student_id,
                "operation": "database.select"
            }
    ) as span:
        try:
            # Business logic
            span.add_event("Executing SQL query", {
                "query": "get_student_by_id",
                "table": "students"
            })
            
            result = await self.db.select(get_student_by_id, args)
            
            span.set_attributes({
                "result.count": len(result),
                "result.found": len(result) > 0
            })
            
            span.set_status(StatusCode.OK)
            return result
        except Exception as err:
            span.record_exception(err)
            span.set_status(StatusCode.ERROR, str(err))
            raise err
```

### Metrics –∏ Alerts

```python
# internal/controller/http/middleware/middleware.py
class HttpMiddleware:
    def metrics_middleware02(self, app: FastAPI):
        # –°–æ–∑–¥–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
        ok_request_counter = self.meter.create_counter(
            name="http.server.ok.request.total",
            description="Total count of successful HTTP requests"
        )
        
        request_duration = self.meter.create_histogram(
            name="http.server.request.duration",
            description="HTTP request duration in seconds"
        )

        @app.middleware("http")
        async def _metrics_middleware(request: Request, call_next):
            start_time = time.time()
            
            # Attributes –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –º–µ—Ç—Ä–∏–∫
            attrs = {
                "method": request.method,
                "endpoint": request.url.path,
                "trace_id": request.state.trace_id
            }
            
            try:
                response = await call_next(request)
                duration = time.time() - start_time
                
                attrs["status_code"] = response.status_code
                
                # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
                if response.status_code < 400:
                    ok_request_counter.add(1, attributes=attrs)
                else:
                    error_request_counter.add(1, attributes=attrs)
                
                request_duration.record(duration, attributes=attrs)
                
                return response
            except Exception as err:
                # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—à–∏–±–æ–∫
                error_request_counter.add(1, attributes={**attrs, "error": str(err)})
                raise
```

### Alert Manager

```python
# infrastructure/telemetry/alertmanager.py
class AlertManager:
    async def __send_error_alert_to_tg(self, trace_id: str, span_id: str):
        # –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ Grafana
        log_link = f"{self.grafana_url}/explore?...&trace_id={trace_id}"
        trace_link = f"{self.grafana_url}/explore?...&query={trace_id}"
        
        text = f"""üö® –û—à–∏–±–∫–∞ –≤ {self.service_name}
TraceID: {trace_id}
SpanID: {span_id}"""

        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üìã –õ–æ–≥–∏", url=log_link)],
            [InlineKeyboardButton(text="üîç –¢—Ä–µ–π—Å", url=trace_link)]
        ])

        await self.bot.send_message(
            self.alert_tg_chat_id,
            text,
            reply_markup=keyboard
        )
```

---

## ü§ñ AI Integration - LLM –∫–∞–∫ —á–∞—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### LLM Client

```python
# pkg/client/external/openai/client.py
class GPTClient(interface.ILLMClient):
    async def generate(
        self,
        history: list[model.Message],
        system_prompt: str = "",
        temperature: float = 0.5,
        llm_model: str = "gpt-4o-mini",
        base64img: str = None
    ) -> str:
        with self.tracer.start_as_current_span("GPTClient.generate", kind=SpanKind.CLIENT) as span:
            try:
                # –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è OpenAI
                messages = [
                    {"role": "system", "content": system_prompt},
                    *[{"role": msg.role, "content": msg.text} for msg in history]
                ]
                
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
                if base64img:
                    messages[-1]["content"] = [
                        {"type": "text", "text": messages[-1]["content"]},
                        {"type": "image_url", "image_url": {"url": f"data:image/png;base64,{base64img}"}}
                    ]

                response = await self.client.chat.completions.create(
                    model=llm_model,
                    messages=messages,
                    temperature=temperature,
                )
                
                span.set_attributes({
                    "llm.model": llm_model,
                    "llm.temperature": temperature,
                    "llm.input_tokens": len(str(messages)),
                    "llm.output_tokens": len(response.choices[0].message.content)
                })
                
                return response.choices[0].message.content
            except Exception as err:
                span.record_exception(err)
                raise
```

### Prompt Engineering –∫–∞–∫ –∫–æ–¥

```python
# internal/service/chat/prompt.py
class PromptGenerator(interface.IPromptGenerator):
    async def get_registrator_prompt(self) -> str:
        formatted_content = await self._format_all_content_metadata()
        
        return f"""
–ö–¢–û –¢–´:
–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—é –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

{formatted_content}

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í:
–¢—ã –î–û–õ–ñ–ï–ù –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:
```json
{{
    "user_message": "–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞",
    "metadata": {{
        "commands": [
            {{
                "description": "–û–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",
                "name": "register_student", 
                "params": {{"login": "...", "password": "..."}}
            }}
        ]
    }}
}}
```

–ö–û–ú–ê–ù–î–´:
- register_student: {{"login": str, "password": str}}
- switch_to_next_expert: {{"next_expert": str}}

–ü–û–ú–ù–ò: –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON!
"""

    async def _format_all_content_metadata(self) -> str:
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
        topics = await self.topic_repo.get_all_topic()
        blocks = await self.topic_repo.get_all_block()
        chapters = await self.topic_repo.get_all_chapter()
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        formatter = EducationDataFormatter(topics, blocks, chapters)
        return formatter.to_hierarchical_json()
```

### Command Pattern –¥–ª—è LLM Actions

```python
# internal/common/model.py
@dataclass
class Command:
    description: str
    name: str
    params: dict

    def to_dict(self):
        return {
            "name": self.name,
            "params": self.params,
            "description": self.description
        }

# internal/service/chat/service.py
async def _execute_registrator_commands(self, student_id: int, commands: list[Command]):
    for command in commands:
        match command.name:
            case "register_student":
                await self._register_student(**command.params)
            case "login_student":
                await self._login_student(**command.params)
            case "switch_to_next_expert":
                await self._switch_expert(student_id, command.params["next_expert"])
            case _:
                self.logger.warning(f"Unknown command: {command.name}")
```

---

## üê≥ Infrastructure as Code

### Docker Compose Orchestration

```yaml
# docker-compose/app.yaml
services:
    backend:
        build:
            context: "../../ai-mentor-backend"
            dockerfile: ".github/Dockerfile"
        container_name: "${BACKEND_CONTAINER_NAME}"
        env_file:
            - "../env/${ENVIRONMENT}/.env"
            - "../env/${ENVIRONMENT}/.env.app"
            - "../env/${ENVIRONMENT}/.env.db"
            - "../env/${ENVIRONMENT}/.env.monitoring"
        ports:
            - "${BACKEND_PORT}:${BACKEND_PORT}"
        restart: unless-stopped
        networks:
            - net
        depends_on:
            - backend-db
            - redis-monitoring
```

### Environment Management

```python
# internal/config/config.py
class Config:
    # Database
    db_pass: str = os.environ.get('BACKEND_POSTGRES_PASSWORD')
    db_user: str = os.environ.get('BACKEND_POSTGRES_USER')
    db_host: str = os.environ.get('BACKEND_POSTGRES_HOST')
    
    # Monitoring
    otlp_host: str = os.environ.get("OTEL_COLLECTOR_HOST")
    grafana_url: str = os.environ.get('GRAFANA_URL')
    
    # External APIs
    openai_api_key: str = os.environ.get('OPENAI_API_KEY')
```

### Makefile –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π

```makefile
# Makefile
.PHONY: deploy build-all stop-all update-all rebuild-all

set-dev-env:
	@export $(cat env/dev/.env env/dev/.env.app env/dev/.env.db env/dev/.env.monitoring | xargs)

build-all: set-env-to-config-template
	@docker compose -f ./docker-compose/db.yaml up -d --build
	sleep 20
	@docker compose -f ./docker-compose/monitoring.yaml up -d --build
	sleep 20
	@docker compose -f ./docker-compose/app.yaml up -d --build

rebuild-app: update-all set-env-to-config-template
	@docker compose -f ./docker-compose/app.yaml down
	@docker compose -f ./docker-compose/app.yaml up -d --build
```

---

## üîÑ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Flow - TBD –≤ –¥–µ–π—Å—Ç–≤–∏–∏

### Git Workflow

```bash
# 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å main
git checkout main
git pull origin main

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏
git checkout -b feature/TASK-123-add-student-authentication
# –∏–ª–∏
git checkout -b bugfix/TASK-124-fix-chat-message-encoding
# –∏–ª–∏  
git checkout -b refactor/TASK-125-optimize-database-queries

# 3. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å —á–∞—Å—Ç—ã–º–∏ –∫–æ–º–º–∏—Ç–∞–º–∏
git add internal/service/auth/
git commit -m "feat(auth): add student JWT authentication

- Implement JWT token generation
- Add password hashing with bcrypt  
- Create authentication middleware
- Add unit tests for auth service

Relates to TASK-123"

# 4. –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã
git add internal/controller/http/handler/auth/
git commit -m "feat(auth): add HTTP authentication endpoints

- POST /auth/login endpoint
- POST /auth/refresh endpoint  
- GET /auth/verify endpoint
- Add request/response models

Relates to TASK-123"

# 5. Push –∏ PR
git push origin feature/TASK-123-add-student-authentication
# –°–æ–∑–¥–∞–µ–º PR –≤ GitHub
```

### Commit Message Convention

```
<type>(<scope>): <description>

<body>

<footer>
```

**Types:**
- `feat`: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- `fix`: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞
- `refactor`: —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API
- `perf`: —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `test`: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- `docs`: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- `chore`: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**Scopes:** auth, chat, edu, repo, service, controller, infrastructure

### Code Review Checklist

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã spans –¥–ª—è tracing
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å proper logging
- [ ] SQL –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –≤ –∫–æ–¥–µ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] Dependency injection —Å–æ–±–ª—é–¥–µ–Ω
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –°–ª–æ–∏ –Ω–µ –Ω–∞—Ä—É—à–∞—é—Ç boundaries
- [ ] –ù–µ—Ç circular dependencies

---

## üß™ Testing Strategy

### Unit Testing

```python
# tests/service/test_chat_service.py
import pytest
from unittest.mock import AsyncMock
from internal.service.chat.service import ChatService
from internal.interface import IChatRepo, IStudentRepo, ILLMClient

@pytest.fixture
def mock_repos():
    return {
        'chat_repo': AsyncMock(spec=IChatRepo),
        'student_repo': AsyncMock(spec=IStudentRepo),
        'llm_client': AsyncMock(spec=ILLMClient),
    }

@pytest.mark.asyncio
async def test_send_message_creates_chat_if_not_exists(mock_repos):
    # Arrange
    mock_repos['chat_repo'].get_chat_by_student_id.return_value = []
    mock_repos['chat_repo'].create_chat.return_value = 1
    
    service = ChatService(**mock_repos)
    
    # Act
    await service.send_message_to_expert(1, "Hello")
    
    # Assert
    mock_repos['chat_repo'].create_chat.assert_called_once_with(1)
```

### Integration Testing

```python
# tests/integration/test_student_repo.py
@pytest.mark.asyncio
async def test_student_repo_full_cycle():
    async with get_test_db() as db:
        repo = StudentRepo(mock_telemetry, db)
        
        # Create
        student_id = await repo.create_student(account_id=1)
        assert student_id > 0
        
        # Read
        students = await repo.get_by_id(student_id)
        assert len(students) == 1
        assert students[0].current_expert == "registrator"
        
        # Update
        await repo.update_student_background(student_id, {
            "programming_experience": "Beginner"
        })
        
        # Verify update
        updated_students = await repo.get_by_id(student_id)
        assert updated_students[0].programming_experience == "Beginner"
```

---

## üõ°Ô∏è Security Best Practices

### Input Validation

```python
# internal/controller/http/handler/chat/model.py
class SendMessageToExpert(BaseModel):
    student_id: int = Field(..., gt=0, description="ID —Å—Ç—É–¥–µ–Ω—Ç–∞")
    text: str = Field(..., min_length=1, max_length=5000, description="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è")
    
    @validator('text')
    def validate_text(cls, v):
        # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
        v = v.strip()
        if not v:
            raise ValueError('–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º')
        return v
    
    @validator('student_id')
    def validate_student_id(cls, v):
        if v <= 0:
            raise ValueError('Student ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º')
        return v
```

### SQL Injection Prevention

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
get_student_by_id = """
SELECT id, account_id, current_expert
FROM students
WHERE id = :student_id AND account_id = :account_id;
"""

async def get_student(self, student_id: int, account_id: int):
    params = {
        'student_id': student_id,
        'account_id': account_id
    }
    return await self.db.select(get_student_by_id, params)

# ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫
query = f"SELECT * FROM students WHERE id = {student_id}"  # SQL Injection!
```

### Sensitive Data Handling

```python
# internal/config/config.py
class Config:
    # ‚úÖ –ß–µ—Ä–µ–∑ environment variables
    openai_api_key: str = os.environ.get('OPENAI_API_KEY')
    db_password: str = os.environ.get('BACKEND_POSTGRES_PASSWORD')
    
    def __repr__(self):
        # ‚úÖ –ú–∞—Å–∫–∏—Ä—É–µ–º —Å–µ–∫—Ä–µ—Ç—ã –≤ –ª–æ–≥–∞—Ö
        return f"Config(db_host={self.db_host}, openai_key=***masked***)"

# –í –ª–æ–≥–∞—Ö
self.logger.info("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LLM –∫–ª–∏–µ–Ω—Ç–∞", {
    "model": model_name,
    "temperature": temperature,
    # ‚ùå –ù–ï –ª–æ–≥–∏—Ä—É–µ–º API –∫–ª—é—á–∏
    # "api_key": self.api_key,  # –û–ü–ê–°–ù–û!
})
```

---

## üöÄ Performance Optimization

### Database Optimization

```python
# Connection pooling
async_engine = create_async_engine(
    f"postgresql+asyncpg://{user}:{password}@{host}:{port}/{db}",
    echo=False,
    future=True,
    pool_size=15,        # –†–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    max_overflow=15,     # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ
    pool_recycle=300     # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
)

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
get_student_with_chat = """
SELECT 
    s.id, s.account_id, s.current_expert,
    c.id as chat_id, c.created_at as chat_created
FROM students s
LEFT JOIN chats c ON s.id = c.student_id
WHERE s.id = :student_id;
"""
```

### Async Best Practices

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
async def get_student_context(self, student_id: int):
    # –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    student_task = self.student_repo.get_by_id(student_id)
    chat_task = self.chat_repo.get_chat_by_student_id(student_id)
    topics_task = self.topic_repo.get_all_topic()
    
    student, chat, topics = await asyncio.gather(
        student_task, 
        chat_task, 
        topics_task
    )
    return self._format_context(student, chat, topics)

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
async def get_student_context_slow(self, student_id: int):
    student = await self.student_repo.get_by_id(student_id)  # –ñ–¥–µ–º
    chat = await self.chat_repo.get_chat_by_student_id(student_id)  # –ñ–¥–µ–º 
    topics = await self.topic_repo.get_all_topic()  # –ñ–¥–µ–º
    return self._format_context(student, chat, topics)
```

### Caching Strategy

```python
# Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
class StudentService:
    async def get_student_profile(self, student_id: int) -> Student:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        cached = await self.redis.get(f"student:profile:{student_id}")
        if cached:
            return Student.model_validate_json(cached)
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
        student = await self.student_repo.get_by_id(student_id)
        
        # –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 5 –º–∏–Ω—É—Ç
        await self.redis.set(
            f"student:profile:{student_id}",
            student.model_dump_json(),
            ttl=300
        )
        
        return student
```

---

## üìä Monitoring Deep Dive

### Custom Metrics

```python
# internal/service/chat/service.py
class ChatService:
    def __init__(self, tel: ITelemetry, ...):
        self.meter = tel.meter()
        
        # –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
        self.messages_counter = self.meter.create_counter(
            name="chat.messages.total",
            description="Total messages processed"
        )
        
        self.llm_calls_duration = self.meter.create_histogram(
            name="chat.llm.duration",
            description="LLM call duration in seconds"
        )
        
        self.expert_switches = self.meter.create_counter(
            name="chat.expert.switches",
            description="Expert switches count"
        )

    async def send_message_to_expert(self, student_id: int, text: str):
        # –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        self.messages_counter.add(1, attributes={
            "student_id": str(student_id),
            "expert": student.current_expert,
            "message_length": len(text)
        })
        
        # –ú–µ—Ç—Ä–∏–∫–∏ LLM –≤—ã–∑–æ–≤–æ–≤
        start_time = time.time()
        llm_response = await self.llm_client.generate(...)
        duration = time.time() - start_time
        
        self.llm_calls_duration.record(duration, attributes={
            "model": "gpt-4o-mini",
            "expert": student.current_expert
        })
```

### Health Checks

```python
# internal/controller/http/handler/health.py
class HealthController:
    async def health_check(self):
        checks = {
            "database": await self._check_database(),
            "redis": await self._check_redis(),
            "llm_api": await self._check_llm_api(),
            "file_storage": await self._check_file_storage()
        }
        
        all_healthy = all(checks.values())
        status_code = 200 if all_healthy else 503
        
        return JSONResponse(
            status_code=status_code,
            content={
                "status": "healthy" if all_healthy else "unhealthy",
                "timestamp": datetime.utcnow().isoformat(),
                "checks": checks
            }
        )
    
    async def _check_database(self) -> bool:
        try:
            await self.db.select("SELECT 1", {})
            return True
        except Exception:
            return False
```

---

## üéØ Advanced Patterns

### Event-Driven Architecture

```python
# internal/common/events.py
@dataclass
class StudentRegisteredEvent:
    student_id: int
    account_id: int
    timestamp: datetime

@dataclass 
class ExpertSwitchedEvent:
    student_id: int
    from_expert: str
    to_expert: str
    timestamp: datetime

# internal/service/chat/service.py
class ChatService:
    async def _switch_expert(self, student_id: int, next_expert: str):
        current_expert = await self._get_current_expert(student_id)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –ë–î
        await self.student_repo.change_current_expert(student_id, next_expert)
        
        # –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏–µ
        event = ExpertSwitchedEvent(
            student_id=student_id,
            from_expert=current_expert,
            to_expert=next_expert,
            timestamp=datetime.utcnow()
        )
        await self.event_publisher.publish("expert.switched", event)
```

### Circuit Breaker Pattern

```python
# pkg/circuit_breaker.py
class CircuitBreaker:
    def __init__(self, failure_threshold: int = 5, timeout: int = 60):
        self.failure_threshold = failure_threshold
        self.timeout = timeout
        self.failure_count = 0
        self.last_failure_time = None
        self.state = "CLOSED"  # CLOSED, OPEN, HALF_OPEN

    async def call(self, func, *args, **kwargs):
        if self.state == "OPEN":
            if time.time() - self.last_failure_time > self.timeout:
                self.state = "HALF_OPEN"
            else:
                raise CircuitBreakerOpenException()

        try:
            result = await func(*args, **kwargs)
            self._on_success()
            return result
        except Exception as e:
            self._on_failure()
            raise

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
class LLMService:
    def __init__(self):
        self.circuit_breaker = CircuitBreaker(failure_threshold=3, timeout=30)
    
    async def generate_response(self, prompt: str):
        return await self.circuit_breaker.call(
            self.llm_client.generate,
            prompt=prompt
        )
```

---

## üìã Checklist –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### 1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–î–µ–Ω—å 1)
- [ ] –ü–æ–Ω—è—Ç—å –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Å–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã  
- [ ] –í—ã–±—Ä–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤ –∫–∞–Ω–±–∞–Ω –¥–æ—Å–∫–µ

### 2. Database Layer (–î–µ–Ω—å 1-2)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `sql_model.py` –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `create_queries`
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤ `internal/model/`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –≤ `query.py`

### 3. Repository Layer (–î–µ–Ω—å 2)
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ `internal/interface/`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Repository —Å —Ç—Ä–µ–π—Å–∏–Ω–≥–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å proper error handling
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è Repository
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL injection –∑–∞—â–∏—Ç—É

### 4. Service Layer (–î–µ–Ω—å 2-3)
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ—Ä–≤–∏—Å–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã

### 5. Controller Layer (–î–µ–Ω—å 3)
- [ ] –°–æ–∑–¥–∞—Ç—å Pydantic –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HTTP handler
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å middleware
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã

### 6. Infrastructure (–î–µ–Ω—å 4)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `main.py` –¥–ª—è DI
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏

### 7. Documentation & Deploy (–î–µ–Ω—å 4-5)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å PR —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
- [ ] –ü—Ä–æ–π—Ç–∏ code review
- [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## üîç Debugging Guide

### –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

```bash
# 1. –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
docker-compose -f docker-compose/db.yaml up -d
python main.py http

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ real-time
docker logs -f backend
docker logs -f grafana

# 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker exec -it backend-postgres psql -U backend-user -d backend

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
docker exec -it monitoring-redis redis-cli
> keys *
> get "student:1"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ

```bash
# Grafana Explore queries
# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ trace
{service_name="backend"} | trace_id="0123456789abcdef"

# –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
{service_name="backend"} | level="ERROR" | __error__=""

# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
{service_name="backend"} | json | http_request_duration > 1.0

# –ú–µ—Ç—Ä–∏–∫–∏ –≤ VictoriaMetrics
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
rate(http_server_ok_request_total[1m])

# P95 latency
histogram_quantile(0.95, rate(http_server_request_duration_bucket[5m]))
```

### Common Issues & Solutions

**1. –í—ã—Å–æ–∫–∏–π latency:**
```python
# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
with self.tracer.start_as_current_span("slow_operation") as span:
    start_time = time.time()
    result = await slow_function()
    duration = time.time() - start_time
    
    span.set_attributes({
        "operation.duration": duration,
        "operation.result_count": len(result)
    })
    
    if duration > 1.0:  # –õ–æ–≥–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        self.logger.warning("Slow operation detected", {
            "operation": "slow_function",
            "duration": duration,
            "threshold": 1.0
        })
```

**2. Memory leaks:**
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
async def cleanup_resources(self):
    try:
        if self.db_pool:
            await self.db_pool.close()
        if self.redis_client:
            await self.redis_client.close()
    except Exception as e:
        self.logger.error("Error during cleanup", {"error": str(e)})
```

**3. Database deadlocks:**
```python
# –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É
async def update_with_retry(self, query: str, params: dict, max_retries: int = 3):
    for attempt in range(max_retries):
        try:
            return await self.db.update(query, params)
        except asyncpg.DeadlockDetectedError:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(0.1 * (2 ** attempt))  # Exponential backoff
```

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ **–ö–ê–ö –†–ï–ê–õ–¨–ù–û** —É—Å—Ç—Ä–æ–µ–Ω –∫–æ–¥ –≤ –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏:

### –ß—Ç–æ –≤—ã –æ—Å–≤–æ–∏–ª–∏:
‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–ª–æ—è–º–∏** - interface ‚Üí model ‚Üí repo ‚Üí service ‚Üí controller  
‚úÖ **Dependency Injection** - –∫–∞–∫ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ main.py  
‚úÖ **Observability** - —Ç—Ä–µ–π—Å–∏–Ω–≥, –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–ª–µ—Ä—Ç—ã  
‚úÖ **Database patterns** - Repository, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, JSONB  
‚úÖ **AI Integration** - LLM –∫–∞–∫ —á–∞—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, Command pattern  
‚úÖ **Infrastructure** - Docker, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥  
‚úÖ **Development Flow** - TBD, –∫–∞–Ω–±–∞–Ω, code review  

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. **–°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ** AI-mentor –ø—Ä–æ–µ–∫—Ç
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ** —á–µ—Ä–µ–∑ `make build-all`
3. **–ò–∑—É—á–∏—Ç–µ** –∫–æ–¥ –≤ –ø–æ—Ä—è–¥–∫–µ: interface ‚Üí model ‚Üí repo ‚Üí service ‚Üí controller
4. **–í–æ–∑—å–º–∏—Ç–µ** –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É –∏–∑ –∫–∞–Ω–±–∞–Ω–∞
5. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ** –ø–æ —á–µ–∫–ª–∏—Å—Ç—É –≤—ã—à–µ

### –ü–æ–º–Ω–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **Type Safety First** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤–µ–∑–¥–µ
- **Observability by Design** - –∫–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è traced
- **Clean Architecture** - —á–µ—Ç–∫–∏–µ boundaries –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
- **Fail Fast** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–µ–∑–¥–µ
- **Infrastructure as Code** - –≤—Å–µ –≤ Git, –Ω–∏—á–µ–≥–æ —Ä—É—á–Ω–æ–≥–æ

**–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É! üöÄ**

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: –¥–µ–∫–∞–±—Ä—å 2024*  
*–í–µ—Ä—Å–∏—è: 2.0*  
*–ê–≤—Ç–æ—Ä—ã: Engineering Team*